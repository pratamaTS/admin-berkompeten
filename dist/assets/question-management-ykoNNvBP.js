import{a as D}from"./VGrid-CSSzMaaB.js";import{p as ae,l as oe,Y as ne,f as b,Z as _e,N as q,$ as se,a0 as P,G as N,B as re,d as a,a1 as ye,a2 as be,a3 as Ve,x as Ce,a4 as K,a5 as we,F as j,a6 as xe,_ as Se,u as ue,g as ie,o as S,c as M,a as o,w as s,b as y,W as x,e as U,t as v,J as R,X as Ie,V as ee,Q as Be,R as Pe}from"./index-DdXJnWct.js";import{m as Ae,c as Fe,u as De,d as te,f as $e,e as Ee,g as ze,V as Te,a as G,b as Re}from"./VTextField-O16lRnKh.js";import{V as Ue,a as Ne}from"./VSelect-DnMzGRyY.js";import{V as Q}from"./VAlert-BPGPchFH.js";import{V as Oe}from"./VTable-CEFMdndI.js";import{V as Le,a as Me,b as Qe}from"./VCard-BxvQr8PX.js";import{f as ce}from"./forwardRefs-CfT2YDHB.js";import{V as je}from"./VSpacer-BqTAFwJX.js";import{m as qe,e as He,u as Je,f as le}from"./VMenu-Jat6TU7I.js";import{V as We}from"./VRow-CHwHpa4a.js";import"./index-Bfw9vqez.js";import"./VCheckboxBtn-DvRfAfcf.js";import"./VSelectionControl-CAF_S9T6.js";import"./VAvatar-CDskOqu1.js";import"./VImg-D3eDJvag.js";import"./lazy-BcUmstZH.js";const Ge=ae({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...qe({origin:"center center",scrollStrategy:"block",transition:{component:He},zIndex:2400})},"VDialog"),Xe=oe()({name:"VDialog",props:Ge(),emits:{"update:modelValue":t=>!0},setup(t,V){let{slots:k}=V;const _=ne(t,"modelValue"),{scopeId:i}=Je(),c=b();function m(g){var r,h;const p=g.relatedTarget,d=g.target;if(p!==d&&((r=c.value)!=null&&r.contentEl)&&((h=c.value)!=null&&h.globalTop)&&![document,c.value.contentEl].includes(d)&&!c.value.contentEl.contains(d)){const C=be(c.value.contentEl);if(!C.length)return;const A=C[0],F=C[C.length-1];p===A?F.focus():A.focus()}}_e&&q(()=>_.value&&t.retainFocus,g=>{g?document.addEventListener("focusin",m):document.removeEventListener("focusin",m)},{immediate:!0}),q(_,async g=>{var p,d;await se(),g?(p=c.value.contentEl)==null||p.focus({preventScroll:!0}):(d=c.value.activatorEl)==null||d.focus({preventScroll:!0})});const f=P(()=>N({"aria-haspopup":"dialog","aria-expanded":String(_.value)},t.activatorProps));return re(()=>{const g=le.filterProps(t);return a(le,N({ref:c,class:["v-dialog",{"v-dialog--fullscreen":t.fullscreen,"v-dialog--scrollable":t.scrollable},t.class],style:t.style},g,{modelValue:_.value,"onUpdate:modelValue":p=>_.value=p,"aria-modal":"true",activatorProps:f.value,role:"dialog"},i),{activator:k.activator,default:function(){for(var p=arguments.length,d=new Array(p),r=0;r<p;r++)d[r]=arguments[r];return a(ye,{root:"VDialog"},{default:()=>{var h;return[(h=k.default)==null?void 0:h.call(k,...d)]}})}})}),ce({},c)}}),Ye=ae({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},multiple:Boolean,showSize:{type:[Boolean,Number],default:!1,validator:t=>typeof t=="boolean"||[1e3,1024].includes(t)},...Ae({prependIcon:"$file"}),modelValue:{type:Array,default:()=>[],validator:t=>Ve(t).every(V=>V!=null&&typeof V=="object")},...Fe({clearable:!0})},"VFileInput"),Ze=oe()({name:"VFileInput",inheritAttrs:!1,props:Ye(),emits:{"click:control":t=>!0,"mousedown:control":t=>!0,"update:focused":t=>!0,"update:modelValue":t=>!0},setup(t,V){let{attrs:k,emit:_,slots:i}=V;const{t:c}=Ce(),m=ne(t,"modelValue"),{isFocused:f,focus:g,blur:p}=De(t),d=P(()=>typeof t.showSize!="boolean"?t.showSize:void 0),r=P(()=>(m.value??[]).reduce((e,u)=>{let{size:I=0}=u;return e+I},0)),h=P(()=>K(r.value,d.value)),C=P(()=>(m.value??[]).map(e=>{const{name:u="",size:I=0}=e;return t.showSize?`${u} (${K(I,d.value)})`:u})),A=P(()=>{var u;const e=((u=m.value)==null?void 0:u.length)??0;return t.showSize?c(t.counterSizeString,e,h.value):c(t.counterString,e)}),F=b(),O=b(),w=b(),H=P(()=>f.value||t.active),$=P(()=>["plain","underlined"].includes(t.variant));function E(){var e;w.value!==document.activeElement&&((e=w.value)==null||e.focus()),f.value||g()}function J(e){n(e)}function W(e){_("mousedown:control",e)}function n(e){var u;(u=w.value)==null||u.click(),_("click:control",e)}function l(e){e.stopPropagation(),E(),se(()=>{m.value=[],xe(t["onClick:clear"],e)})}return q(m,e=>{(!Array.isArray(e)||!e.length)&&w.value&&(w.value.value="")}),re(()=>{const e=!!(i.counter||t.counter),u=!!(e||i.details),[I,de]=we(k),{modelValue:ut,...pe}=te.filterProps(t),me=$e(t);return a(te,N({ref:F,modelValue:m.value,"onUpdate:modelValue":z=>m.value=z,class:["v-file-input",{"v-file-input--chips":!!t.chips,"v-input--plain-underlined":$.value},t.class],style:t.style,"onClick:prepend":J},I,pe,{centerAffix:!$.value,focused:f.value}),{...i,default:z=>{let{id:L,isDisabled:T,isDirty:X,isReadonly:Y,isValid:fe}=z;return a(Ee,N({ref:O,"prepend-icon":t.prependIcon,onMousedown:W,onClick:n,"onClick:clear":l,"onClick:prependInner":t["onClick:prependInner"],"onClick:appendInner":t["onClick:appendInner"]},me,{id:L.value,active:H.value||X.value,dirty:X.value,disabled:T.value,focused:f.value,error:fe.value===!1}),{...i,default:ve=>{var Z;let{props:{class:ge,...he}}=ve;return a(j,null,[a("input",N({ref:w,type:"file",readonly:Y.value,disabled:T.value,multiple:t.multiple,name:t.name,onClick:B=>{B.stopPropagation(),Y.value&&B.preventDefault(),E()},onChange:B=>{if(!B.target)return;const ke=B.target;m.value=[...ke.files??[]]},onFocus:E,onBlur:p},he,de),null),a("div",{class:ge},[!!((Z=m.value)!=null&&Z.length)&&(i.selection?i.selection({fileNames:C.value,totalBytes:r.value,totalBytesReadable:h.value}):t.chips?C.value.map(B=>a(Ue,{key:B,size:"small",color:t.color},{default:()=>[B]})):C.value.join(", "))])])}})},details:u?z=>{var L,T;return a(j,null,[(L=i.details)==null?void 0:L.call(i,z),e&&a(j,null,[a("span",null,null),a(ze,{active:!!((T=m.value)!=null&&T.length),value:A.value},i.counter)])])}:void 0})}),ce({},F,O,w)}}),Ke=t=>(Be("data-v-1fcbf0e3"),t=t(),Pe(),t),et={class:"table-header"},tt={class:"table-container"},lt=Ke(()=>o("thead",null,[o("tr",null,[o("th",null,"Packet Name"),o("th",null,"Subtopic Name"),o("th",null,"Question Number"),o("th",null,"Question"),o("th",null,"Option A"),o("th",null,"Option B"),o("th",null,"Option C"),o("th",null,"Option D"),o("th",null,"Option E"),o("th",null,"Correct Answer"),o("th",null,"Discussion"),o("th",null,"Is Active"),o("th",null,"Created Date"),o("th",null,"Actions")])],-1)),at=["innerHTML"],ot={key:0},nt={class:"pagination"},st={__name:"QuestionList",setup(t){const V=ue(),k=localStorage.getItem("token"),_=b([]),i=b(""),c=b(null),m=b([]),f=b({current_page:1,from:1,last_page:1,next_page_url:null,prev_page_url:null,total:0}),g=b(!1),p=b(null),d=b(""),r=b(""),h=async(n=1,l=null,e="")=>{try{let u=`https://gateway.berkompeten.com/api/admin/master/question?page=${n}`;l&&(console.log("Q: ",l),u+=`&question_packet_id=${l}`),e&&(u+=`&search=${e.toLowerCase()}`);const I=await D.get(u,{headers:{Authorization:`Bearer ${k}`}});_.value=I.data.data.data,f.value=I.data.data}catch(u){console.log("err: ",u),u.response&&u.response.status===401&&(localStorage.removeItem("token"),V.push("/login"))}},C=async()=>{try{const n=await D.get("https://gateway.berkompeten.com/api/admin/master/question-packet/fetch-all",{headers:{Authorization:`Bearer ${k}`}});m.value=n.data.data.map(l=>({id:l.id,name:l.name}))}catch(n){console.error("Error fetching question packet options:",n)}};q([c,i],([n,l])=>{h(1,n,l)});const A=()=>{var n=null;c.value&&(n=c.value),f.value.next_page_url&&h(f.value.current_page+1,n)},F=()=>{var n=null;c.value&&(n=c.value),f.value.prev_page_url&&h(f.value.current_page-1,n)},O=()=>{localStorage.removeItem("question_id"),V.push("/question/detail")},w=async()=>{try{const n=await D.get("https://gateway.berkompeten.com/api/admin/master/question/download-template",{responseType:"blob",headers:{Authorization:`Bearer ${k}`}}),l=window.URL.createObjectURL(new Blob([n.data])),e=document.createElement("a");e.href=l,e.setAttribute("download","questions_template.xlsx"),document.body.appendChild(e),e.click()}catch(n){console.error("Error downloading template:",n)}},H=()=>{localStorage.removeItem("question_id"),g.value=!0},$=()=>{g.value=!1,p.value=null,d.value="",r.value=""},E=async()=>{if(!p.value){r.value="Please upload a file",setTimeout(()=>{r.value=""},5e3);return}const n=new FormData;n.append("file",p.value[0]),console.log("FILE: ",p.value[0]);try{const l=await D.post("https://gateway.berkompeten.com/api/admin/master/question/bulk-upsert",n,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${k}`}});d.value="Bulk upsert completed successfully",setTimeout(()=>{$(),h(f.value.current_page)},2e3)}catch(l){l.response&&l.response.status===422?(r.value="Validation error: "+JSON.stringify(l.response.data.message.file[0]),setTimeout(()=>{r.value=""},5e3)):(r.value="Error bulk upsert: "+l.response.data.message,setTimeout(()=>{r.value=""},5e3))}},J=n=>{localStorage.setItem("question_id",n),V.push("/question/detail")},W=async n=>{try{await D.delete(`https://gateway.berkompeten.com/api/admin/master/question?question_id=${n}`,{headers:{Authorization:`Bearer ${k}`}}),h(f.value.current_page)}catch(l){console.log("err: ",l)}};return ie(()=>{h(),C()}),(n,l)=>(S(),M("div",null,[o("div",et,[a(Te,{modelValue:i.value,"onUpdate:modelValue":l[0]||(l[0]=e=>i.value=e),label:"Search",class:"mx-3",solo:""},null,8,["modelValue"]),a(Ne,{modelValue:c.value,"onUpdate:modelValue":l[1]||(l[1]=e=>c.value=e),items:m.value,"item-value":"id","item-title":"name",label:"Filter by Packet",class:"mx-3",solo:"",clearable:""},null,8,["modelValue","items"]),a(x,{color:"#0080ff",class:"mx-1",onClick:O},{default:s(()=>[y("Create")]),_:1}),a(x,{color:"#0080ff",class:"mx-1",onClick:H},{default:s(()=>[y("Bulk Upsert")]),_:1}),a(x,{color:"#0080ff",class:"mx-1",onClick:w},{default:s(()=>[y("Download Template")]),_:1})]),a(G,null,{default:s(()=>[d.value?(S(),U(Q,{key:0,type:"success",dismissible:"","onClick:close":l[2]||(l[2]=e=>d.value="")},{default:s(()=>[y(v(d.value),1)]),_:1})):R("",!0),r.value?(S(),U(Q,{key:1,type:"error",dismissible:"","onClick:close":l[3]||(l[3]=e=>r.value="")},{default:s(()=>[y(v(r.value),1)]),_:1})):R("",!0)]),_:1}),o("div",tt,[a(Oe,{"fixed-header":""},{default:s(()=>[lt,o("tbody",null,[(S(!0),M(j,null,Ie(_.value,e=>(S(),M("tr",{key:e.id},[o("td",null,v(e.question_packet.name),1),o("td",null,v(e.subtopic_list.subtopic),1),o("td",null,v(e.question_number),1),o("td",null,v(e.question),1),o("td",null,v(e.option_a),1),o("td",null,v(e.option_b),1),o("td",null,v(e.option_c),1),o("td",null,v(e.option_d),1),o("td",null,v(e.option_e),1),o("td",null,v(e.correct_answer),1),o("td",{innerHTML:e.discussion},null,8,at),o("td",null,v(e.is_active),1),o("td",null,v(e.created_date),1),o("td",null,[e.is_used===!1?(S(),M("div",ot,[a(x,{icon:"",onClick:u=>J(e.id),class:"mx-1",color:"transparent",style:{padding:"0",border:"none","background-color":"transparent","box-shadow":"none"}},{default:s(()=>[a(ee,{style:{color:"orange"}},{default:s(()=>[y("ri-edit-line")]),_:1})]),_:2},1032,["onClick"]),a(x,{icon:"",onClick:u=>W(e.id),class:"mx-1",color:"transparent",style:{padding:"0",border:"none","background-color":"transparent","box-shadow":"none"}},{default:s(()=>[a(ee,{style:{color:"red"}},{default:s(()=>[y("ri-delete-bin-line")]),_:1})]),_:2},1032,["onClick"])])):R("",!0)])]))),128))])]),_:1})]),o("div",nt,[a(x,{onClick:F,disabled:!f.value.prev_page_url,class:"mx-1",color:"#0080ff"},{default:s(()=>[y("Previous")]),_:1},8,["disabled"]),a(x,{onClick:A,disabled:!f.value.next_page_url,class:"mx-1",color:"#0080ff"},{default:s(()=>[y("Next")]),_:1},8,["disabled"])]),a(Xe,{modelValue:g.value,"onUpdate:modelValue":l[7]||(l[7]=e=>g.value=e),"max-width":"500px"},{default:s(()=>[a(Le,null,{default:s(()=>[a(Me,{class:"text-h5"},{default:s(()=>[y("Bulk Upsert")]),_:1}),a(G,null,{default:s(()=>[a(Ze,{modelValue:p.value,"onUpdate:modelValue":l[4]||(l[4]=e=>p.value=e),label:"Upload Excel File",accept:".csv,.xlsx,.xls","prepend-icon":"mdi-upload"},null,8,["modelValue"])]),_:1}),a(Qe,null,{default:s(()=>[a(je),a(x,{color:"blue darken-1",text:"",onClick:$},{default:s(()=>[y("Cancel")]),_:1}),a(x,{color:"#0080ff",text:"",onClick:E},{default:s(()=>[y("Upload")]),_:1})]),_:1}),a(G,null,{default:s(()=>[d.value?(S(),U(Q,{key:0,type:"success",dismissible:"","onClick:close":l[5]||(l[5]=e=>d.value="")},{default:s(()=>[y(v(d.value),1)]),_:1})):R("",!0),r.value?(S(),U(Q,{key:1,type:"error",dismissible:"","onClick:close":l[6]||(l[6]=e=>r.value="")},{default:s(()=>[y(v(r.value),1)]),_:1})):R("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},rt=Se(st,[["__scopeId","data-v-1fcbf0e3"]]),St={__name:"question-management",setup(t){const V=localStorage.getItem("token"),k=b(null),_=ue();return ie(async()=>{if(V)try{const i=await D.get("https://gateway.berkompeten.com/api/admin/profile",{headers:{Authorization:`Bearer ${V}`}});k.value=i.data}catch(i){i.response&&i.response.status===401&&_.push("/login")}else _.push("/login")}),(i,c)=>(S(),U(We,{class:"match-height"},{default:s(()=>[a(Re,{cols:"12",md:"12"},{default:s(()=>[a(rt)]),_:1})]),_:1}))}};export{St as default};
