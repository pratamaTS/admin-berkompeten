import{a as U}from"./VGrid-H4nAnDsn.js";import{_ as A,h as $,r as n,P as M,i as F,o as p,c as w,a as s,d as l,w as t,b as u,a2 as V,f as h,t as m,L as b,F as P,j as z,R,S as j}from"./index-AryBdys7.js";import{V as E}from"./VTextField-ZuzApsZG.js";import{V as C}from"./VAlert-Dclja9nK.js";import{V as S,a as O,b as J}from"./VCardText-Ccz8IcNf.js";import{V as G}from"./VTable-ClaSuRDA.js";import{V as H,a as K}from"./VCard-DRv5nRi-.js";import{V as Q}from"./VCardTitle-gQEIOlk7.js";import{V as W,a as X}from"./VFileInput-C9Nqc1aK.js";import{V as Y}from"./VSpacer-V9-cM7Gz.js";import"./forwardRefs-BgKS6qNZ.js";import"./index-DYhDWbac.js";import"./VInput-0JT9cSES.js";import"./easing-DY7PVvcf.js";import"./VAvatar-Bk7bSWw5.js";import"./VImg-BnnpGyml.js";import"./VOverlay-souyEm7B.js";import"./lazy-IcXCMn0l.js";import"./VChip-0NNzlpK8.js";const Z=v=>(R("data-v-2be77732"),v=v(),j(),v),q={class:"table-header"},ee={class:"table-container"},ae=Z(()=>s("thead",null,[s("tr",null,[s("th",null,"File Name"),s("th",null,"URL"),s("th",null,"Created At")])],-1)),te={class:"pagination"},le={__name:"MediaList",setup(v){const k=$(),x=localStorage.getItem("token"),_=n([]),r=n("");n(null),n([]);const i=n({current_page:1,from:1,last_page:1,next_page_url:null,prev_page_url:null,total:0}),y=n(!1),f=n(null),d=n(""),o=n(""),g=async(c=1,e="")=>{try{let a=`https://gateway.berkompeten.com/api/admin/master/media?page=${c}`;e&&(a+=`&search=${e.toLowerCase()}`);const T=await U.get(a,{headers:{Authorization:`Bearer ${x}`}});_.value=T.data.data.data,i.value=T.data.data}catch(a){console.log("err: ",a),a.response&&a.response.status===401&&(localStorage.removeItem("token"),k.push("/login"))}};M([r],([c])=>{g(1,c)});const B=()=>{i.value.next_page_url&&g(i.value.current_page+1,r.value)},D=()=>{i.value.prev_page_url&&g(i.value.current_page-1,r.value)},L=()=>{localStorage.removeItem("question_id"),y.value=!0},I=()=>{y.value=!1,f.value=null,d.value="",o.value=""},N=async()=>{if(!f.value){o.value="Please upload a file",setTimeout(()=>{o.value=""},5e3);return}const c=new FormData;c.append("image",f.value[0]),console.log("FILE: ",f.value[0]);try{const e=await U.post("https://gateway.berkompeten.com/api/admin/master/upload-image",c,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${x}`}});d.value="Upload image completed successfully",setTimeout(()=>{I(),g(i.value.current_page)},2e3)}catch(e){e.response&&e.response.status===422?(o.value="Validation error: "+JSON.stringify(e.response.data.message.file[0]),setTimeout(()=>{o.value=""},5e3)):(o.value="Error upload image: "+e.response.data.message,setTimeout(()=>{o.value=""},5e3))}};return F(()=>{g()}),(c,e)=>(p(),w("div",null,[s("div",q,[l(E,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=a=>r.value=a),label:"Search",class:"mx-3",solo:""},null,8,["modelValue"]),l(V,{color:"#0080ff",class:"mx-1",onClick:L},{default:t(()=>[u("Upload")]),_:1})]),l(S,null,{default:t(()=>[d.value?(p(),h(C,{key:0,type:"success",dismissible:"","onClick:close":e[1]||(e[1]=a=>d.value="")},{default:t(()=>[u(m(d.value),1)]),_:1})):b("",!0),o.value?(p(),h(C,{key:1,type:"error",dismissible:"","onClick:close":e[2]||(e[2]=a=>o.value="")},{default:t(()=>[u(m(o.value),1)]),_:1})):b("",!0)]),_:1}),s("div",ee,[l(G,{"fixed-header":""},{default:t(()=>[ae,s("tbody",null,[(p(!0),w(P,null,z(_.value,a=>(p(),w("tr",{key:a.id},[s("td",null,m(a.filename),1),s("td",null,m(a.url),1),s("td",null,m(a.created_at),1),u("az ")]))),128))])]),_:1})]),s("div",te,[l(V,{onClick:D,disabled:!i.value.prev_page_url,class:"mx-1",color:"#0080ff"},{default:t(()=>[u("Previous")]),_:1},8,["disabled"]),l(V,{onClick:B,disabled:!i.value.next_page_url,class:"mx-1",color:"#0080ff"},{default:t(()=>[u("Next")]),_:1},8,["disabled"])]),l(X,{modelValue:y.value,"onUpdate:modelValue":e[6]||(e[6]=a=>y.value=a),"max-width":"500px"},{default:t(()=>[l(H,null,{default:t(()=>[l(Q,{class:"text-h5"},{default:t(()=>[u("Upload Image")]),_:1}),l(S,null,{default:t(()=>[l(W,{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=a=>f.value=a),label:"Upload File",accept:".jpg,.jpeg,.png","prepend-icon":"mdi-upload"},null,8,["modelValue"])]),_:1}),l(K,null,{default:t(()=>[l(Y),l(V,{color:"blue darken-1",text:"",onClick:I},{default:t(()=>[u("Cancel")]),_:1}),l(V,{color:"#0080ff",text:"",onClick:N},{default:t(()=>[u("Upload")]),_:1})]),_:1}),l(S,null,{default:t(()=>[d.value?(p(),h(C,{key:0,type:"success",dismissible:"","onClick:close":e[4]||(e[4]=a=>d.value="")},{default:t(()=>[u(m(d.value),1)]),_:1})):b("",!0),o.value?(p(),h(C,{key:1,type:"error",dismissible:"","onClick:close":e[5]||(e[5]=a=>o.value="")},{default:t(()=>[u(m(o.value),1)]),_:1})):b("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},oe=A(le,[["__scopeId","data-v-2be77732"]]),Ce={__name:"media-management",setup(v){const k=localStorage.getItem("token"),x=n(null),_=$();return F(async()=>{if(k)try{const r=await U.get("https://gateway.berkompeten.com/api/admin/profile",{headers:{Authorization:`Bearer ${k}`}});x.value=r.data}catch(r){r.response&&r.response.status===401&&_.push("/login")}else _.push("/login")}),(r,i)=>(p(),h(O,{class:"match-height"},{default:t(()=>[l(J,{cols:"12",md:"12"},{default:t(()=>[l(oe)]),_:1})]),_:1}))}};export{Ce as default};
