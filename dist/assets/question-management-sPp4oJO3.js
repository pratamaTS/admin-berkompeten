import{a as F}from"./VGrid-CSSzMaaB.js";import{p as ae,l as oe,$ as ne,f as k,a0 as Ce,N as q,a1 as se,W as L,G as z,B as ue,d as a,a2 as ke,a3 as we,a4 as ye,x as be,a5 as X,a6 as Ve,F as Q,a7 as xe,_ as Le,u as re,g as ie,o as B,c as W,a as n,w as u,b as C,Z as x,e as E,t as v,J as O,Y as Se,V as ee,Q as Be,R as Ie}from"./index-DPEDR26h.js";import{m as Pe,a as Ae,u as Fe,V as te,f as De,b as $e,c as Ee,d as ze,e as G,g as Te,h as Re,i as Ue}from"./VTextField-DCNpKg2D.js";import{V as Ne,a as Oe,b as M}from"./VSelect-DSacmhDJ.js";import{V as Me}from"./VTable-CKMm6Jub.js";import{f as ce}from"./forwardRefs-BeqTK34e.js";import{V as Qe}from"./VSpacer-3161MXxN.js";import{m as qe,e as je,u as He,f as le}from"./VMenu-B2Yka7ZX.js";import{V as Je}from"./VRow-C6F8yCX9.js";import{V as We}from"./VCol-C23xuD4c.js";import"./VImg-w7ApfuSw.js";import"./VCheckboxBtn-D5-kZFid.js";import"./lazy-CmXcimDv.js";const Ge=ae({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...qe({origin:"center center",scrollStrategy:"block",transition:{component:je},zIndex:2400})},"VDialog"),Ye=oe()({name:"VDialog",props:Ge(),emits:{"update:modelValue":l=>!0},setup(l,w){let{slots:_}=w;const h=ne(l,"modelValue"),{scopeId:o}=He(),i=k();function p(m){var r,g;const d=m.relatedTarget,c=m.target;if(d!==c&&((r=i.value)!=null&&r.contentEl)&&((g=i.value)!=null&&g.globalTop)&&![document,i.value.contentEl].includes(c)&&!i.value.contentEl.contains(c)){const y=we(i.value.contentEl);if(!y.length)return;const I=y[0],P=y[y.length-1];d===I?P.focus():I.focus()}}Ce&&q(()=>h.value&&l.retainFocus,m=>{m?document.addEventListener("focusin",p):document.removeEventListener("focusin",p)},{immediate:!0}),q(h,async m=>{var d,c;await se(),m?(d=i.value.contentEl)==null||d.focus({preventScroll:!0}):(c=i.value.activatorEl)==null||c.focus({preventScroll:!0})});const f=L(()=>z({"aria-haspopup":"dialog","aria-expanded":String(h.value)},l.activatorProps));return ue(()=>{const m=le.filterProps(l);return a(le,z({ref:i,class:["v-dialog",{"v-dialog--fullscreen":l.fullscreen,"v-dialog--scrollable":l.scrollable},l.class],style:l.style},m,{modelValue:h.value,"onUpdate:modelValue":d=>h.value=d,"aria-modal":"true",activatorProps:f.value,role:"dialog"},o),{activator:_.activator,default:function(){for(var d=arguments.length,c=new Array(d),r=0;r<d;r++)c[r]=arguments[r];return a(ke,{root:"VDialog"},{default:()=>{var g;return[(g=_.default)==null?void 0:g.call(_,...c)]}})}})}),ce({},i)}}),Ze=ae({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},multiple:Boolean,showSize:{type:[Boolean,Number],default:!1,validator:l=>typeof l=="boolean"||[1e3,1024].includes(l)},...Pe({prependIcon:"$file"}),modelValue:{type:Array,default:()=>[],validator:l=>ye(l).every(w=>w!=null&&typeof w=="object")},...Ae({clearable:!0})},"VFileInput"),Ke=oe()({name:"VFileInput",inheritAttrs:!1,props:Ze(),emits:{"click:control":l=>!0,"mousedown:control":l=>!0,"update:focused":l=>!0,"update:modelValue":l=>!0},setup(l,w){let{attrs:_,emit:h,slots:o}=w;const{t:i}=be(),p=ne(l,"modelValue"),{isFocused:f,focus:m,blur:d}=Fe(l),c=L(()=>typeof l.showSize!="boolean"?l.showSize:void 0),r=L(()=>(p.value??[]).reduce((e,t)=>{let{size:b=0}=t;return e+b},0)),g=L(()=>X(r.value,c.value)),y=L(()=>(p.value??[]).map(e=>{const{name:t="",size:b=0}=e;return l.showSize?`${t} (${X(b,c.value)})`:t})),I=L(()=>{var t;const e=((t=p.value)==null?void 0:t.length)??0;return l.showSize?i(l.counterSizeString,e,g.value):i(l.counterString,e)}),P=k(),T=k(),V=k(),j=L(()=>f.value||l.active),R=L(()=>["plain","underlined"].includes(l.variant));function A(){var e;V.value!==document.activeElement&&((e=V.value)==null||e.focus()),f.value||m()}function H(e){U(e)}function J(e){h("mousedown:control",e)}function U(e){var t;(t=V.value)==null||t.click(),h("click:control",e)}function s(e){e.stopPropagation(),A(),se(()=>{p.value=[],xe(l["onClick:clear"],e)})}return q(p,e=>{(!Array.isArray(e)||!e.length)&&V.value&&(V.value.value="")}),ue(()=>{const e=!!(o.counter||l.counter),t=!!(e||o.details),[b,de]=Ve(_),{modelValue:ut,...pe}=te.filterProps(l),fe=De(l);return a(te,z({ref:P,modelValue:p.value,"onUpdate:modelValue":D=>p.value=D,class:["v-file-input",{"v-file-input--chips":!!l.chips,"v-input--plain-underlined":R.value},l.class],style:l.style,"onClick:prepend":H},b,pe,{centerAffix:!R.value,focused:f.value}),{...o,default:D=>{let{id:N,isDisabled:$,isDirty:Y,isReadonly:Z,isValid:ve}=D;return a($e,z({ref:T,"prepend-icon":l.prependIcon,onMousedown:J,onClick:U,"onClick:clear":s,"onClick:prependInner":l["onClick:prependInner"],"onClick:appendInner":l["onClick:appendInner"]},fe,{id:N.value,active:j.value||Y.value,dirty:Y.value,disabled:$.value,focused:f.value,error:ve.value===!1}),{...o,default:me=>{var K;let{props:{class:ge,..._e}}=me;return a(Q,null,[a("input",z({ref:V,type:"file",readonly:Z.value,disabled:$.value,multiple:l.multiple,name:l.name,onClick:S=>{S.stopPropagation(),Z.value&&S.preventDefault(),A()},onChange:S=>{if(!S.target)return;const he=S.target;p.value=[...he.files??[]]},onFocus:A,onBlur:d},_e,de),null),a("div",{class:ge},[!!((K=p.value)!=null&&K.length)&&(o.selection?o.selection({fileNames:y.value,totalBytes:r.value,totalBytesReadable:g.value}):l.chips?y.value.map(S=>a(Ne,{key:S,size:"small",color:l.color},{default:()=>[S]})):y.value.join(", "))])])}})},details:t?D=>{var N,$;return a(Q,null,[(N=o.details)==null?void 0:N.call(o,D),e&&a(Q,null,[a("span",null,null),a(Ee,{active:!!(($=p.value)!=null&&$.length),value:I.value},o.counter)])])}:void 0})}),ce({},P,T,V)}}),Xe=l=>(Be("data-v-fe8999ce"),l=l(),Ie(),l),et={class:"table-header"},tt={class:"table-container"},lt=Xe(()=>n("thead",null,[n("tr",null,[n("th",null,"Packet Name"),n("th",null,"Subtopic Name"),n("th",null,"Question Number"),n("th",null,"Question"),n("th",null,"Option A"),n("th",null,"Option B"),n("th",null,"Option C"),n("th",null,"Option D"),n("th",null,"Option E"),n("th",null,"Correct Answer"),n("th",null,"Discussion"),n("th",null,"Is Active"),n("th",null,"Created At"),n("th",null,"Actions")])],-1)),at=["innerHTML"],ot={class:"pagination"},nt={__name:"QuestionList",setup(l){const w=re(),_=localStorage.getItem("token"),h=k([]),o=k(""),i=k(null),p=k([]),f=k({current_page:1,from:1,last_page:1,next_page_url:null,prev_page_url:null,total:0}),m=k(!1),d=k(null),c=k(""),r=k(""),g=async(s=1,e=null)=>{try{let t=`https://gateway.berkompeten.com/api/admin/master/question?page=${s}`;e&&(console.log("Q: ",e),t+=`&question_packet_id=${e}`);const b=await F.get(t,{headers:{Authorization:`Bearer ${_}`}});h.value=b.data.data.data,f.value=b.data.data}catch(t){console.log("err: ",t),t.response&&t.response.status===401&&(localStorage.removeItem("token"),w.push("/login"))}},y=async()=>{try{const s=await F.get("https://gateway.berkompeten.com/api/admin/master/question-packet/fetch-all",{headers:{Authorization:`Bearer ${_}`}});p.value=s.data.data.map(e=>({id:e.id,name:e.name}))}catch(s){console.error("Error fetching question packet options:",s)}};q(i,s=>{g(1,s)});const I=L(()=>{let s=h.value;return o.value&&(s=s.filter(e=>e.question_packet.name.toLowerCase().includes(o.value.toLowerCase())||e.subtopic_list.subtopic.toLowerCase().includes(o.value.toLowerCase())||e.question_number.toLowerCase().includes(o.value.toLowerCase())||e.scenario.toLowerCase().includes(o.value.toLowerCase())||e.question.toLowerCase().includes(o.value.toLowerCase())||e.option_a.toLowerCase().includes(o.value.toLowerCase())||e.option_b.toLowerCase().includes(o.value.toLowerCase())||e.option_c.toLowerCase().includes(o.value.toLowerCase())||e.option_d.toLowerCase().includes(o.value.toLowerCase())||e.option_e.toLowerCase().includes(o.value.toLowerCase())||e.correct_answer.toLowerCase().includes(o.value.toLowerCase())||e.image_url.toLowerCase().includes(o.value.toLowerCase())||e.discussion.toLowerCase().includes(o.value.toLowerCase())||e.created_at.toLowerCase().includes(o.value.toLowerCase()))),s}),P=()=>{var s=null;i.value&&(s=i.value),f.value.next_page_url&&g(f.value.current_page+1,s)},T=()=>{var s=null;i.value&&(s=i.value),f.value.prev_page_url&&g(f.value.current_page-1,s)},V=()=>{w.push("/question/detail")},j=async()=>{try{const s=await F.get("https://gateway.berkompeten.com/api/admin/master/question/download-template",{responseType:"blob",headers:{Authorization:`Bearer ${_}`}}),e=window.URL.createObjectURL(new Blob([s.data])),t=document.createElement("a");t.href=e,t.setAttribute("download","questions_template.xlsx"),document.body.appendChild(t),t.click()}catch(s){console.error("Error downloading template:",s)}},R=()=>{m.value=!0},A=()=>{m.value=!1,d.value=null,c.value="",r.value=""},H=async()=>{if(!d.value){r.value="Please upload a file",setTimeout(()=>{r.value=""},5e3);return}const s=new FormData;s.append("file",d.value[0]),console.log("FILE: ",d.value[0]);try{const e=await F.post("https://gateway.berkompeten.com/api/admin/master/question/bulk-upsert",s,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${_}`}});c.value="Bulk upsert completed successfully",setTimeout(()=>{A(),g(f.value.current_page)},2e3)}catch(e){e.response&&e.response.status===422?(r.value="Validation error: "+JSON.stringify(e.response.data.message.file[0]),setTimeout(()=>{r.value=""},5e3)):(r.value="Error bulk upsert: "+e.response.data.message,setTimeout(()=>{r.value=""},5e3))}},J=s=>{localStorage.setItem("question_packet_id",s),w.push("/question/detail")},U=async s=>{try{await F.delete(`https://gateway.berkompeten.com/api/admin/master/question?question_id=${s}`,{headers:{Authorization:`Bearer ${_}`}}),g(f.value.current_page)}catch(e){console.log("err: ",e)}};return ie(()=>{g(),y()}),(s,e)=>(B(),W("div",null,[n("div",et,[a(ze,{modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=t=>o.value=t),label:"Search",class:"mx-3",solo:""},null,8,["modelValue"]),a(Oe,{modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=t=>i.value=t),items:p.value,"item-value":"id","item-title":"name",label:"Filter by Packet",class:"mx-3",solo:"",clearable:""},null,8,["modelValue","items"]),a(x,{color:"#0080ff",class:"mx-1",onClick:V},{default:u(()=>[C("Create")]),_:1}),a(x,{color:"#0080ff",class:"mx-1",onClick:R},{default:u(()=>[C("Bulk Upsert")]),_:1}),a(x,{color:"#0080ff",class:"mx-1",onClick:j},{default:u(()=>[C("Download Template")]),_:1})]),a(G,null,{default:u(()=>[c.value?(B(),E(M,{key:0,type:"success",dismissible:"","onClick:close":e[2]||(e[2]=t=>c.value="")},{default:u(()=>[C(v(c.value),1)]),_:1})):O("",!0),r.value?(B(),E(M,{key:1,type:"error",dismissible:"","onClick:close":e[3]||(e[3]=t=>r.value="")},{default:u(()=>[C(v(r.value),1)]),_:1})):O("",!0)]),_:1}),n("div",tt,[a(Me,{"fixed-header":""},{default:u(()=>[lt,n("tbody",null,[(B(!0),W(Q,null,Se(I.value,t=>(B(),W("tr",{key:t.id},[n("td",null,v(t.question_packet.name),1),n("td",null,v(t.subtopic_list.subtopic),1),n("td",null,v(t.question_number),1),n("td",null,v(t.question),1),n("td",null,v(t.option_a),1),n("td",null,v(t.option_b),1),n("td",null,v(t.option_c),1),n("td",null,v(t.option_d),1),n("td",null,v(t.option_e),1),n("td",null,v(t.correct_answer),1),n("td",{innerHTML:t.discussion},null,8,at),n("td",null,v(t.is_active),1),n("td",null,v(t.created_at),1),n("td",null,[a(x,{icon:"",onClick:b=>J(t.question_packet.id),class:"mx-1",color:"#0080ff"},{default:u(()=>[a(ee,null,{default:u(()=>[C("ri-hourglass-fill")]),_:1})]),_:2},1032,["onClick"]),a(x,{icon:"",onClick:b=>U(t.id),class:"mx-1",color:"#0080ff"},{default:u(()=>[a(ee,null,{default:u(()=>[C("mdi-delete")]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:1})]),n("div",ot,[a(x,{onClick:T,disabled:!f.value.prev_page_url,class:"mx-1",color:"#0080ff"},{default:u(()=>[C("Previous")]),_:1},8,["disabled"]),a(x,{onClick:P,disabled:!f.value.next_page_url,class:"mx-1",color:"#0080ff"},{default:u(()=>[C("Next")]),_:1},8,["disabled"])]),a(Ye,{modelValue:m.value,"onUpdate:modelValue":e[7]||(e[7]=t=>m.value=t),"max-width":"500px"},{default:u(()=>[a(Te,null,{default:u(()=>[a(Re,{class:"text-h5"},{default:u(()=>[C("Bulk Upsert")]),_:1}),a(G,null,{default:u(()=>[a(Ke,{modelValue:d.value,"onUpdate:modelValue":e[4]||(e[4]=t=>d.value=t),label:"Upload Excel File",accept:".csv,.xlsx,.xls","prepend-icon":"mdi-upload"},null,8,["modelValue"])]),_:1}),a(Ue,null,{default:u(()=>[a(Qe),a(x,{color:"blue darken-1",text:"",onClick:A},{default:u(()=>[C("Cancel")]),_:1}),a(x,{color:"#0080ff",text:"",onClick:H},{default:u(()=>[C("Upload")]),_:1})]),_:1}),a(G,null,{default:u(()=>[c.value?(B(),E(M,{key:0,type:"success",dismissible:"","onClick:close":e[5]||(e[5]=t=>c.value="")},{default:u(()=>[C(v(c.value),1)]),_:1})):O("",!0),r.value?(B(),E(M,{key:1,type:"error",dismissible:"","onClick:close":e[6]||(e[6]=t=>r.value="")},{default:u(()=>[C(v(r.value),1)]),_:1})):O("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},st=Le(nt,[["__scopeId","data-v-fe8999ce"]]),wt={__name:"question-management",setup(l){const w=localStorage.getItem("token"),_=k(null),h=re();return ie(async()=>{if(w)try{const o=await F.get("https://gateway.berkompeten.com/api/admin/profile",{headers:{Authorization:`Bearer ${w}`}});_.value=o.data}catch(o){o.response&&o.response.status===401&&h.push("/login")}else h.push("/login")}),(o,i)=>(B(),E(Je,{class:"match-height"},{default:u(()=>[a(We,{cols:"12",md:"12"},{default:u(()=>[a(st)]),_:1})]),_:1}))}};export{wt as default};
