import{p as ye,l as we,a3 as ke,a0 as $,f,ab as qe,ac as Ce,g as ae,N as q,Y as Ie,B as Se,a9 as Pe,d as o,G as W,F as X,D as ie,ad as Fe,ae as Ee,$ as Z,aa as Ae,af as Be,ag as Re,u as ve,M as Ue,ah as ue,o as A,e as H,w as l,a as C,a1 as O,H as w,V as ce,c as de,t as ee,J as T,ai as $e,b as G}from"./index-BuweSC7k.js";import{a as me}from"./avatar-1-BeeGmpGQ.js";import{a as k}from"./VGrid-DdhISMTF.js";import{b as c,V as te,a as oe}from"./VCardText-Da75-8QG.js";import{V as De}from"./VCard-DR5KrZ6Z.js";import{V as ze}from"./VAvatar-BNXXEKq6.js";import{V as Ne}from"./ssrBoot-Dzdgc6-h.js";import{V as Me}from"./VForm-3bdDSy-O.js";import{V as fe}from"./VSelect-BwRBjeg0.js";import{m as Oe,a as Te,u as Ge,b as pe,f as He,c as Qe,d as je,V as y}from"./VTextField-BCyqz9Ge.js";import{f as Le}from"./forwardRefs-DhnuETI-.js";import{I as Je}from"./index-D6g7V8uL.js";import{V as Ye}from"./VSwitch-DmPERXeR.js";import{V as ge}from"./VAlert-DmGkpJ_B.js";import"./VImg-Bs-5OWkF.js";import"./VList-C4tUinwh.js";import"./VOverlay-buJtnEuK.js";import"./lazy-DHdgVzYC.js";import"./VMenu-Dvtx2QFl.js";import"./VCheckboxBtn-BibZVn2B.js";import"./VSelectionControl-BN1a_ej4.js";import"./VChip-hgHZTnW0.js";const Ke=ye({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...Oe(),...Te()},"VTextarea"),_e=we()({name:"VTextarea",directives:{Intersect:Je},inheritAttrs:!1,props:Ke(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,I){let{attrs:g,emit:v,slots:u}=I;const a=ke(e,"modelValue"),{isFocused:n,focus:V,blur:D}=Ge(e),Q=$(()=>typeof e.counterValue=="function"?e.counterValue(a.value):(a.value||"").toString().length),S=$(()=>{if(g.maxlength)return g.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function h(i,m){var d,_;!e.autofocus||!i||(_=(d=m[0].target)==null?void 0:d.focus)==null||_.call(d)}const z=f(),P=f(),B=qe(""),F=f(),R=$(()=>e.persistentPlaceholder||n.value||e.active);function U(){var i;F.value!==document.activeElement&&((i=F.value)==null||i.focus()),n.value||V()}function j(i){U(),v("click:control",i)}function L(i){v("mousedown:control",i)}function J(i){i.stopPropagation(),U(),Z(()=>{a.value="",Ae(e["onClick:clear"],i)})}function r(i){var d;const m=i.target;if(a.value=m.value,(d=e.modelModifiers)!=null&&d.trim){const _=[m.selectionStart,m.selectionEnd];Z(()=>{m.selectionStart=_[0],m.selectionEnd=_[1]})}}const t=f(),s=f(+e.rows),p=$(()=>["plain","underlined"].includes(e.variant));Ce(()=>{e.autoGrow||(s.value=+e.rows)});function E(){e.autoGrow&&Z(()=>{if(!t.value||!P.value)return;const i=getComputedStyle(t.value),m=getComputedStyle(P.value.$el),d=parseFloat(i.getPropertyValue("--v-field-padding-top"))+parseFloat(i.getPropertyValue("--v-input-padding-top"))+parseFloat(i.getPropertyValue("--v-field-padding-bottom")),_=t.value.scrollHeight,N=parseFloat(i.lineHeight),Y=Math.max(parseFloat(e.rows)*N+d,parseFloat(m.getPropertyValue("--v-input-control-height"))),K=parseFloat(e.maxRows)*N+d||1/0,x=Re(_??0,Y,K);s.value=Math.floor((x-d)/N),B.value=Be(x)})}ae(E),q(a,E),q(()=>e.rows,E),q(()=>e.maxRows,E),q(()=>e.density,E);let b;return q(t,i=>{i?(b=new ResizeObserver(E),b.observe(t.value)):b==null||b.disconnect()}),Ie(()=>{b==null||b.disconnect()}),Se(()=>{const i=!!(u.counter||e.counter||e.counterValue),m=!!(i||u.details),[d,_]=Pe(g),{modelValue:N,...Y}=pe.filterProps(e),K=He(e);return o(pe,W({ref:z,modelValue:a.value,"onUpdate:modelValue":x=>a.value=x,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":p.value},e.class],style:e.style},d,Y,{centerAffix:s.value===1&&!p.value,focused:n.value}),{...u,default:x=>{let{id:M,isDisabled:se,isDirty:re,isReadonly:Ve,isValid:he}=x;return o(Qe,W({ref:P,style:{"--v-textarea-control-height":B.value},onClick:j,onMousedown:L,"onClick:clear":J,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},K,{id:M.value,active:R.value||re.value,centerAffix:s.value===1&&!p.value,dirty:re.value||e.dirty,disabled:se.value,focused:n.value,error:he.value===!1}),{...u,default:be=>{let{props:{class:le,...ne}}=be;return o(X,null,[e.prefix&&o("span",{class:"v-text-field__prefix"},[e.prefix]),ie(o("textarea",W({ref:F,class:le,value:a.value,onInput:r,autofocus:e.autofocus,readonly:Ve.value,disabled:se.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:U,onBlur:D},ne,_),null),[[Fe("intersect"),{handler:h},null,{once:!0}]]),e.autoGrow&&ie(o("textarea",{class:[le,"v-textarea__sizer"],id:`${ne.id}-sizer`,"onUpdate:modelValue":xe=>a.value=xe,ref:t,readonly:!0,"aria-hidden":"true"},null),[[Ee,a.value]]),e.suffix&&o("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:m?x=>{var M;return o(X,null,[(M=u.details)==null?void 0:M.call(u,x),i&&o(X,null,[o("span",null,null),o(je,{active:e.persistentCounter||n.value,value:Q.value,max:S.value},u.counter)])])}:void 0})}),Le({},z,P,F)}}),We={class:"d-flex flex-column justify-center gap-5"},Xe={class:"d-flex flex-wrap gap-2"},Ze=C("span",{class:"d-none d-sm-block"},"Upload new photo",-1),et=C("span",{class:"d-none d-sm-block"},"Reset",-1),tt=C("p",{class:"text-body-1 mb-0"},"Allowed JPG, GIF or PNG. Max size of 2048MB",-1),ot={key:0,class:"text-red-500 text-sm"},at={style:{color:"red"}},st={key:0,class:"text-red-500 text-sm"},rt={__name:"QuestionDetailUpsert",setup(e){const I=ve();Ue();const g=localStorage.getItem("question_id"),v=f([]),u=f([]),a=ue({image_url:me,question_packet_id:"",subtopic_list_id:"",scenario:"",question:"",option_a:"",option_b:"",option_c:"",option_d:"",option_e:"",correct_answer:"",image_url:"",discussion:"",is_active:0}),n=ue({}),V=localStorage.getItem("token"),D=f(null),Q=$(()=>a.image_url||me),S=f(""),h=f(""),z=async r=>{try{const t=await k.get(`https://gateway.berkompeten.com/api/admin/master/question/detail?id=${r}`,{headers:{Authorization:`Bearer ${V}`}});Object.assign(a,t.data.data)}catch(t){console.error("Error fetching question data:",t)}},P=async()=>{try{a.is_active=a.is_active?1:0,await k({method:"post",url:"https://gateway.berkompeten.com/api/admin/master/question/upsert",data:a,headers:{Authorization:`Bearer ${V}`}}),S.value="Question saved successfully!",setTimeout(()=>{B(),I.push("/question-management")},2e3)}catch(r){console.error("Error submitting form:",r),r.response&&r.response.data?r.response.status===500?h.value=r.response.data.message||"An error occurred while saving. Please try again.":r.response.data.error?(Object.assign(n,r.response.data.message),console.log("ERROR: ",n)):h.value="An error occurred while saving. Please try again.":h.value="An error occurred while saving the question. Please try again."}},B=()=>{Object.assign(a,{image_url:null,question_packet_id:null,subtopic_list_id:null,question_number:null,scenario:"",question:"",option_a:"",option_b:"",option_c:"",option_d:"",option_e:"",correct_answer:"",image_url:"",discussion:"",is_active:0})},F=async()=>{try{const r=await k.get("https://gateway.berkompeten.com/api/admin/master/question-packet/fetch",{headers:{Authorization:`Bearer ${V}`}});v.value=r.data.data.map(t=>({id:t.id,name:t.name}))}catch(r){console.error("Error fetching question packet options:",r)}},R=async(r="")=>{try{const t=await k.get(`https://gateway.berkompeten.com/api/admin/master/subtopic/fetch?search=${r}`,{headers:{Authorization:`Bearer ${V}`}});u.value=t.data.data.map(s=>({id:s.id,name:s.subtopic}))}catch(t){console.error("Error fetching subtopic list:",t)}},U=async()=>{try{var r="https://gateway.berkompeten.com/api/admin/master/question/next-number";a.question_packet_id&&(r=r+"?question_packet_id="+a.question_packet_id);const t=await k.get(r,{headers:{Authorization:`Bearer ${V}`}});a.question_number=t.data.data.next_number,console.log("next number: ",a.question_number)}catch(t){console.error("Error fetching next number:",t)}},j=async r=>{const t=r.target.files[0],s=new FormData;s.append("image",t);try{const p=await k.post("https://gateway.berkompeten.com/api/admin/master/upload-image",s,{headers:{Authorization:`Bearer ${V}`,"Content-Type":"multipart/form-data"}});a.image_url=p.data.data.image_url}catch(p){console.error("Error uploading image:",p)}},L=()=>{a.image_url="",a.is_active=a.is_active?1:0};q(()=>a.question_packet_id,(r,t)=>{console.log(`question_packet_id changed from ${t} to ${r}`),r&&!g&&U()}),ae(()=>{F(),R(),g?z(g):localStorage.removeItem("question_id")});const J=r=>{R(r)};return q(()=>a.subtopic_list_id,r=>{r===""&&R("")}),(r,t)=>(A(),H(oe,null,{default:l(()=>[o(c,{cols:"12"},{default:l(()=>[o(De,{title:"Question Details"},{default:l(()=>[o(te,{class:"d-flex"},{default:l(()=>[o(ze,{rounded:"lg",size:"100",class:"me-6",image:Q.value},null,8,["image"]),C("form",We,[C("div",Xe,[o(O,{color:"#0080ff",onClick:t[0]||(t[0]=s=>{var p;return(p=w(D))==null?void 0:p.click()})},{default:l(()=>[o(ce,{icon:"ri-upload-cloud-line",class:"d-sm-none"}),Ze]),_:1}),C("input",{ref_key:"refInputEl",ref:D,type:"file",name:"file",accept:".jpeg,.png,.jpg,GIF",hidden:"",onInput:j},null,544),o(O,{type:"reset",color:"error",variant:"outlined",onClick:L},{default:l(()=>[et,o(ce,{icon:"ri-refresh-line",class:"d-sm-none"})]),_:1})]),tt,n.image_url?(A(),de("div",ot,[C("span",at,ee(n.image_url[0]),1)])):T("",!0)])]),_:1}),o(Ne),o(te,null,{default:l(()=>[o(Me,{onSubmit:$e(P,["prevent"])},{default:l(()=>[o(oe,null,{default:l(()=>[o(c,{cols:"12"},{default:l(()=>[o(fe,{modelValue:a.question_packet_id,"onUpdate:modelValue":t[1]||(t[1]=s=>a.question_packet_id=s),"error-messages":n.question_packet_id,label:"Question Packet",items:w(v),placeholder:"Select question packet","item-value":"id","item-title":"name"},null,8,["modelValue","error-messages","items"])]),_:1}),o(c,{cols:"12"},{default:l(()=>[o(fe,{modelValue:a.subtopic_list_id,"onUpdate:modelValue":t[2]||(t[2]=s=>a.subtopic_list_id=s),"error-messages":n.subtopic_list_id,label:"Sub Topic List",items:w(u),placeholder:"Select Sub Topic List","item-value":"id","item-title":"name",filter:J,"menu-props":{closeOnContentClick:!1}},null,8,["modelValue","error-messages","items"])]),_:1}),o(c,{cols:"12"},{default:l(()=>[o(y,{modelValue:a.question_number,"onUpdate:modelValue":t[3]||(t[3]=s=>a.question_number=s),"error-messages":n.question_number,label:"Question Number",readonly:""},null,8,["modelValue","error-messages"])]),_:1}),o(c,{cols:"12"},{default:l(()=>[o(y,{modelValue:a.scenario,"onUpdate:modelValue":t[4]||(t[4]=s=>a.scenario=s),"error-messages":n.scenario,label:"Scenario"},null,8,["modelValue","error-messages"])]),_:1}),o(c,{cols:"12"},{default:l(()=>[o(_e,{modelValue:a.question,"onUpdate:modelValue":t[5]||(t[5]=s=>a.question=s),"error-messages":n.question,label:"Question",placeholder:"Enter question"},null,8,["modelValue","error-messages"])]),_:1}),o(c,{cols:"12"},{default:l(()=>[o(y,{modelValue:a.option_a,"onUpdate:modelValue":t[6]||(t[6]=s=>a.option_a=s),"error-messages":n.option_a,label:"Option A",placeholder:"Enter option A"},null,8,["modelValue","error-messages"])]),_:1}),o(c,{cols:"12"},{default:l(()=>[o(y,{modelValue:a.option_b,"onUpdate:modelValue":t[7]||(t[7]=s=>a.option_b=s),"error-messages":n.option_b,label:"Option B",placeholder:"Enter option B"},null,8,["modelValue","error-messages"])]),_:1}),o(c,{cols:"12"},{default:l(()=>[o(y,{modelValue:a.option_c,"onUpdate:modelValue":t[8]||(t[8]=s=>a.option_c=s),"error-messages":n.option_c,label:"Option C",placeholder:"Enter option C"},null,8,["modelValue","error-messages"])]),_:1}),o(c,{cols:"12"},{default:l(()=>[o(y,{modelValue:a.option_d,"onUpdate:modelValue":t[9]||(t[9]=s=>a.option_d=s),"error-messages":n.option_d,label:"Option D",placeholder:"Enter option D"},null,8,["modelValue","error-messages"])]),_:1}),o(c,{cols:"12"},{default:l(()=>[o(y,{modelValue:a.option_e,"onUpdate:modelValue":t[10]||(t[10]=s=>a.option_e=s),"error-messages":n.option_e,label:"Option E",placeholder:"Enter option E"},null,8,["modelValue","error-messages"])]),_:1}),o(c,{cols:"12"},{default:l(()=>[o(y,{modelValue:a.correct_answer,"onUpdate:modelValue":t[11]||(t[11]=s=>a.correct_answer=s),"error-messages":n.correct_answer,label:"Correct Answer",placeholder:"Enter correct answer"},null,8,["modelValue","error-messages"])]),_:1}),o(c,{cols:"12"},{default:l(()=>[o(_e,{modelValue:a.discussion,"onUpdate:modelValue":t[12]||(t[12]=s=>a.discussion=s),"error-messages":n.discussion,label:"Discussion",placeholder:"Enter discussion"},null,8,["modelValue","error-messages"])]),_:1}),o(c,{cols:"12"},{default:l(()=>[o(Ye,{color:"#0080ff",modelValue:a.is_active,"onUpdate:modelValue":t[13]||(t[13]=s=>a.is_active=s),"error-messages":n.is_active,label:"Is Active"},null,8,["modelValue","error-messages"]),n.image_url?(A(),de("div",st)):T("",!0)]),_:1}),o(c,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:l(()=>[o(O,{type:"submit",color:"#0080ff"},{default:l(()=>[G("Save")]),_:1}),o(O,{onClick:B,color:"secondary",variant:"outlined"},{default:l(()=>[G("Reset")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(te,null,{default:l(()=>[w(S)?(A(),H(ge,{key:0,type:"success",dismissible:"","onClick:close":t[14]||(t[14]=s=>S.value="")},{default:l(()=>[G(ee(w(S)),1)]),_:1})):T("",!0),w(h)?(A(),H(ge,{key:1,type:"error",dismissible:"","onClick:close":t[15]||(t[15]=s=>h.value="")},{default:l(()=>[G(ee(w(h)),1)]),_:1})):T("",!0)]),_:1})]),_:1})]),_:1})]),_:1}))}},St={__name:"question-detail",setup(e){const I=localStorage.getItem("token"),g=f(null),v=ve();return ae(async()=>{if(I)try{const u=await k.get("https://gateway.berkompeten.com/api/admin/profile",{headers:{Authorization:`Bearer ${I}`}});g.value=u.data}catch(u){u.response&&u.response.status===401&&v.push("/login")}else v.push("/login")}),(u,a)=>(A(),H(oe,{class:"match-height"},{default:l(()=>[o(c,{cols:"12",md:"12"},{default:l(()=>[o(rt)]),_:1})]),_:1}))}};export{St as default};
