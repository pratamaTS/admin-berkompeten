import{a as w}from"./VGrid-CSSzMaaB.js";import{_ as Q,u as x,f as _,N as T,W as O,g as y,o as C,c as k,a as e,d as s,w as r,b as d,Z as p,F as U,Y as q,t as n,V as L,Q as z,R as E,e as R}from"./index-3zjSl10J.js";import{V as F}from"./VTextField-DIOBComm.js";import{V as M}from"./VSelect-ByAqds1t.js";import{V as H}from"./VTable-CdG8sX0n.js";import{V as j}from"./VRow-D9jpOeoN.js";import{V as W}from"./VCol-oNScIwzW.js";import"./forwardRefs-BJiYyVSU.js";import"./VImg-3UcRuBQ4.js";import"./VMenu-Buh32mfO.js";import"./lazy-BHNoIRKO.js";import"./VCheckboxBtn-DJ84BFHn.js";const Y=h=>(z("data-v-290c16a9"),h=h(),E(),h),Z={class:"table-header"},G={class:"table-container"},J=Y(()=>e("thead",null,[e("tr",null,[e("th",null,"Packet Name"),e("th",null,"Subtopic Name"),e("th",null,"Question Number"),e("th",null,"Question"),e("th",null,"Option A"),e("th",null,"Option B"),e("th",null,"Option C"),e("th",null,"Option D"),e("th",null,"Option E"),e("th",null,"Correct Answer"),e("th",null,"Discussion"),e("th",null,"Is Active"),e("th",null,"Created At"),e("th",null,"Actions")])],-1)),K=["innerHTML"],X={class:"pagination"},ee={__name:"QuestionList",setup(h){const c=x(),m=localStorage.getItem("token"),f=_([]),l=_(""),u=_(null),b=_([]),i=_({current_page:1,from:1,last_page:1,next_page_url:null,prev_page_url:null,total:0}),v=async(a=1,o=null)=>{try{let t=`https://gateway.berkompeten.com/api/admin/master/question?page=${a}`;o&&(console.log("Q: ",o),t+=`&question_packet_id=${o}`);const g=await w.get(t,{headers:{Authorization:`Bearer ${m}`}});f.value=g.data.data.data,i.value=g.data.data}catch(t){console.log("err: ",t),t.response&&t.response.status===401&&(localStorage.removeItem("token"),c.push("/login"))}},V=async()=>{try{const a=await w.get("https://gateway.berkompeten.com/api/admin/master/question-packet/fetch",{headers:{Authorization:`Bearer ${m}`}});b.value=a.data.data.map(o=>({id:o.id,name:o.name}))}catch(a){console.error("Error fetching question packet options:",a)}};T(u,a=>{v(1,a)});const B=O(()=>{let a=f.value;return l.value&&(a=a.filter(o=>o.question_packet.name.toLowerCase().includes(l.value.toLowerCase())||o.subtopic_list.subtopic.toLowerCase().includes(l.value.toLowerCase())||o.question_number.toLowerCase().includes(l.value.toLowerCase())||o.scenario.toLowerCase().includes(l.value.toLowerCase())||o.question.toLowerCase().includes(l.value.toLowerCase())||o.option_a.toLowerCase().includes(l.value.toLowerCase())||o.option_b.toLowerCase().includes(l.value.toLowerCase())||o.option_c.toLowerCase().includes(l.value.toLowerCase())||o.option_d.toLowerCase().includes(l.value.toLowerCase())||o.option_e.toLowerCase().includes(l.value.toLowerCase())||o.correct_answer.toLowerCase().includes(l.value.toLowerCase())||o.image_url.toLowerCase().includes(l.value.toLowerCase())||o.discussion.toLowerCase().includes(l.value.toLowerCase())||o.created_at.toLowerCase().includes(l.value.toLowerCase()))),a}),A=()=>{var a=null;u.value&&(a=u.value),i.value.next_page_url&&v(i.value.current_page+1,a)},S=()=>{var a=null;u.value&&(a=u.value),i.value.prev_page_url&&v(i.value.current_page-1,a)},$=()=>{c.push("/question/detail")},I=async()=>{try{const a=await w.get("https://gateway.berkompeten.com/api/admin/master/question/download-template",{responseType:"blob",headers:{Authorization:`Bearer ${m}`}}),o=window.URL.createObjectURL(new Blob([a.data])),t=document.createElement("a");t.href=o,t.setAttribute("download","questions_template.xlsx"),document.body.appendChild(t),t.click()}catch(a){console.error("Error downloading template:",a)}},D=()=>{c.push("/bulk-upsert")},P=a=>{localStorage.setItem("question_packet_id",a),c.push("/question/detail")},N=async a=>{try{await w.delete(`https://gateway.berkompeten.com/api/admin/master/question?question_id=${a}`,{headers:{Authorization:`Bearer ${m}`}}),v(i.value.current_page)}catch(o){console.log("err: ",o)}};return y(()=>{v(),V()}),(a,o)=>(C(),k("div",null,[e("div",Z,[s(F,{modelValue:l.value,"onUpdate:modelValue":o[0]||(o[0]=t=>l.value=t),label:"Search",class:"mx-3",solo:""},null,8,["modelValue"]),s(M,{modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=t=>u.value=t),items:b.value,"item-value":"id","item-title":"name",label:"Filter by Packet",class:"mx-3",solo:"",clearable:""},null,8,["modelValue","items"]),s(p,{color:"#0080ff",class:"mx-1",onClick:$},{default:r(()=>[d("Create")]),_:1}),s(p,{color:"#0080ff",class:"mx-1",onClick:D},{default:r(()=>[d("Bulk Upsert")]),_:1}),s(p,{color:"#0080ff",class:"mx-1",onClick:I},{default:r(()=>[d("Download Template")]),_:1})]),e("div",G,[s(H,{"fixed-header":""},{default:r(()=>[J,e("tbody",null,[(C(!0),k(U,null,q(B.value,t=>(C(),k("tr",{key:t.id},[e("td",null,n(t.question_packet.name),1),e("td",null,n(t.subtopic_list.subtopic),1),e("td",null,n(t.question_number),1),e("td",null,n(t.question),1),e("td",null,n(t.option_a),1),e("td",null,n(t.option_b),1),e("td",null,n(t.option_c),1),e("td",null,n(t.option_d),1),e("td",null,n(t.option_e),1),e("td",null,n(t.correct_answer),1),e("td",{innerHTML:t.discussion},null,8,K),e("td",null,n(t.is_active),1),e("td",null,n(t.created_at),1),e("td",null,[s(p,{icon:"",onClick:g=>P(t.question_packet.id),class:"mx-1",color:"#0080ff"},{default:r(()=>[s(L,null,{default:r(()=>[d("mdi-pencil")]),_:1})]),_:2},1032,["onClick"]),s(p,{icon:"",onClick:g=>N(t.id),class:"mx-1",color:"#0080ff"},{default:r(()=>[s(L,null,{default:r(()=>[d("mdi-delete")]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:1})]),e("div",X,[s(p,{onClick:S,disabled:!i.value.prev_page_url,class:"mx-1",color:"#0080ff"},{default:r(()=>[d("Previous")]),_:1},8,["disabled"]),s(p,{onClick:A,disabled:!i.value.next_page_url,class:"mx-1",color:"#0080ff"},{default:r(()=>[d("Next")]),_:1},8,["disabled"])])]))}},te=Q(ee,[["__scopeId","data-v-290c16a9"]]),_e={__name:"question-management",setup(h){const c=localStorage.getItem("token"),m=_(null),f=x();return y(async()=>{if(c)try{const l=await w.get("https://gateway.berkompeten.com/api/admin/profile",{headers:{Authorization:`Bearer ${c}`}});m.value=l.data}catch(l){l.response&&l.response.status===401&&f.push("/login")}else f.push("/login")}),(l,u)=>(C(),R(j,{class:"match-height"},{default:r(()=>[s(W,{cols:"12",md:"12"},{default:r(()=>[s(te)]),_:1})]),_:1}))}};export{_e as default};
